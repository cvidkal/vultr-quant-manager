name: Start Quant Server

on:
  schedule:
    # 08:50 ET (10 min early for boot time). 12:50 UTC covers both EST and EDT.
    - cron: "50 12 * * 1-5"   # Mon–Fri 12:50 UTC → 08:50 EDT / 07:50 EST
  workflow_dispatch:           # allow manual trigger

jobs:
  start:
    name: Create Vultr Instance
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: pip install requests

      - name: Start server
        env:
          VULTR_API_KEY:          ${{ secrets.VULTR_API_KEY }}
          VULTR_SNAPSHOT_ID:      ${{ secrets.VULTR_SNAPSHOT_ID }}
          TS_AUTH_KEY:            ${{ secrets.TS_AUTH_KEY }}
          VULTR_REGION:           ${{ vars.VULTR_REGION }}       # e.g. ewr
          VULTR_PLAN:             ${{ vars.VULTR_PLAN }}         # e.g. vc2-2c-4gb
        run: python vultr_manager.py start
